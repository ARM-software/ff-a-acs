# Arm FF-A v1.2 ACS Test scenarios
-----------------------------------------------------

This document presents the mapping of the rules in the FF-A specification to the
test cases and the steps followed in the tests. This also provides the information
about the test coverage scenarios that are implemented in the current release of
ACS and the scenarios that are planned for the future releases.


| TestName                                                         | Test Assertions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Section                           | Checked by ACS Now | Test Approach or Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ffa_version_negotiation | FFA_VERSION Usage: <br> Once the caller invokes any FF-A ABI other than FFA_VERSION, the version negotiation phase is complete. Once an FF-A version has been negotiated between a caller and a callee, the version may not be changed for the lifetime of the calling component. The callee must treat the negotiated version as the only supported version for subsequent interactions with the caller. | 13.2.2 | YES | 1. SP registers a valid higher minor FFA version as part of the negotiation phase. <br> 2. SP retries the FFA_VERSION call with a lower valid minor FFA version <br>  3. SPMC must return error as this violates the negotiation term of the specification. |
| ffa_msg_wait_rx_buff_rel | FFA_MSG_WAIT function syntax: <br> Flags: <br> – Bit[0]: Retain RX Buffer Ownership flag. <br> * This flag specifies if the caller relinquishes Ownership of its RX buffer. <br> * It is ignored by a callee if the caller does not have ownership of its RX Buffer. <br> * Only valid at the virtual or Secure physical FF-A instance. It is ignored by a callee at all other instances. <br> * b’0: The caller relinquishes ownership of its RX buffer. <br>* b’1: The caller does not relinquish ownership of its RX buffer. | 14.1 | YES | 1. Initiate Direct request call chain from Client SP/VM dispatcher to Server SP. <br> Register memory management buffer in both partitions for memory transactions. <br> 2. Complete memory share to server SP from Client partition and pass memory handle in a direct message. <br> 3. Server SP receives the data and relinquishes the memory region back to the client. <br> 4. Server SP enters wait mode by FFA_MSG_WAIT without releasing its RX_BUFFER by setting the corresponding bit in FFA_MSG_WAIT flags. <br> 5. Client SP reshares the memory to the server and initiates a direct request to share the memory handle. <br> 6. The server processes the handle releases back the memory region and enters the wait state again but without retaining the RX buffer by not setting the required bit in flags. <br> 7. Ensure that RX_BUFFER is released during test case cleanup to verify ABI functionality.|
| ffa_partition_info_get_regs | To discover the ID (see Chapter 6 Identification and Discovery) and other properties of partitions. <br> This information is, Requested by specifying a UUID as an input parameter as described in Table 13.39. <br> Returned in registers as encoded in a partition information descriptor as described in Table 13.40. | 13.9.1 | YES | 1. From one of the partition check FFA_PARTITION_INFO_GET_REGS is supported by FFA_FEATURE Query. <br> 2. Query FFA_PARTITION_INFO_GET_REGS for this UUID and validate the returned partition information descriptor for correct encoding. |
| ffa_partition_info_get_lsp | Deploy and discover logical SP partition at EL3. | 3.2 | YES | 1. Use FFA_PARTITION_INFO_GET_REGS to discovery EL3 LSP proerties and verify against database |
| ffa_run_direct_req | FFA_RUN From SP during Direct Request Call Chain | 9.2.3 | NO | 1. Initiate Direct request call chain from Client SP/VM dispatcher to Server SP. <br> 2. Initiate another Direct request call chain with a third partition from the server and enter the wait state at a known branching point. <br> 3. Entering the wait state from the third partition should unwind the call chain to the server partition. <br> 4. From the server partition use FFA_RUN to allocate cycles to the third Partition. <br> 5. Once resumed into the third partition, use FFA_WAIT to enter the back wait state and resume the server partition to complete the test scenario. |
| mem_share_impdef <br> mem_lend_impdef <br>  mem_donate_impdef | A Sender could specify an IMPLEMENTATION DEFINED value in the IMPLEMENTATION DEFINED value field for each Receiver. This value must be specified by the Receiver when retrieving the memory region. The Sender must ensure it informs the Receiver of this value via an IMPLEMENTATION DEFINED mechanism such as a partition message. If this field is unused it is MBZ. | 1.11.3 | YES | 1. Initialise a VM/SP and SP/SP combination test. <br> 2. Replicate Mem Donate, Share, Lend Test Scenario and exercise nonzero impdef field. <br> Check if the relayer can validate impdef field and then complete the response, otherwise return INVALID Parameters. <br> Complete the test flow by using the correct impdef value during memory transactions. |
| share_multi_borrower_flag_check | FFA_MEM_RETRIEVE_REQ - Multi Borrower Check Bypass | 11.11.4.2 | YES | 1. Initiate a multiborrower memory share operation from the client side. <br> 2. From one of the receivers, try memory retrieve operation without setting the identities of all borrowers. <br> 3. Check for error code. <br> 4. Set the Bypass flag and check the retrieve operation without setting the identities of all borrowers. Check for successful operation. |
| lend_multi_borrower_flag_check | FFA_MEM_RETRIEVE_REQ - Multi Borrower Check Bypass | 11.11.4.2 | NO | 1. Initiate a multiborrower memory lend operation from the client side. <br> 2. From one of the receivers, try memory retrieve operation without setting the identities of all borrowers. <br> 3. Check for error code. <br> 4. Set the Bypass flag and check the retrieve operation without setting the identities of all borrowers. Check for successful operation. |
| ffa_msg_send2_uuid_check | Indirect Message - UUID Encoding in Partition Message  | 7.3 | NO | 1. Register partition message from a client end point to a server endpoint by utilizing UUID binded to indirect messaging as per test model.<br> 2. Configure the partition messag header filed with corresponding UUID and sender/receiver.<br> 3. Invoke FFA_MSG_SEND2 ABI to transfer partition message to the target endpoint and relayer must signal the scheduler endpoint of this pending message.<br> 4. Process the pending notification and schedule the traget partition to receive the message with correct UUID binding in the message header.<br> 5. Complete the test invocation by entering wait state. | 
| sp_el1_int_mask | Self S-Int delivery for SEL1 SP with interrupts masked | 9.2.3 | YES | 1. Initiate a call chain from the client to a secure partition via direct message (CPU allocation mode). <br> 2. From the server partition, Register self-secure interrupt by programming a trusted watchdog. <br> 3. Mask all interrupts to the current PE by accessing PE Registers. <br> 4. Wait for the watchdog to elapse and trigger an interrupt to the target PE. <br> 5. Interrupt should be masked and not injected into the partition. <br> 6. Initiate direct response from the server partition after verifying interrupt was not fired. <br> 7. Direct response call should overridden by the relayer to to handle the pending interrupt by injecting FFA_INTERRUPT. <br> 8. Verify that the interrupt handler was serviced. |
| sp_yield_spmc_mode | Runtime model for Secure interrupt handling: SP can use the smc(FFA_YIELD) transition to relinquish control back to its partition manager and enter the blocked state. | 6.4.2 | NO | 1. In Normal World Scheduled mode create a direct request call chain to a target SP to register secure interrupt. <br> 2. Interrupt to the target SP should be triggered after call chain unwinding to resume the SP in SPMC Scheduled Mode. <br> 3. Use FFA_YIELD to yield control back to preempted SP.|
| ffa_direct_message2 | FFA_MSG_SEND_DIRECT_REQ2/FFA_MSG_SEND_DIRECT_RESP2 - UUID based Messaging Interface | 15.4/5 | YES |  1. Query FFA_FEATURES for DIRECT_REQ2 and DIRECT_RESP2 interfaces. <br> 2. Invalid parameter check <br>*Invalid Sender/Receiver <br> *Invalid UUID<br>3. Invalid state transition check after direct request. <br> 4. BUSY FLAG Check for Preempted and Blocked. |
| ffa_console_log | Allows FF-A entity to provide debug logging to the console.| 13.12 | NO |  1. FFA_FEATURE Check for Console Log <br> 2. If FFA_CONSOLE_LOG is Supported, Pass an Invalid Character count for SMC32 Convention and check for error. <br> 3.Use Valid Character count and sequence to pipe test characters to console. <br> 4. Repeat same steps for SMC64 log abi|