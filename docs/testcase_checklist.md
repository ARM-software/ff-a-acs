
# Arm FF-A ACS Testcase checklist
-----------------------------------------------------

This document presents the mapping of the rules in the FF-A specification to the
test cases and the steps followed in the tests. This also provides the information
about the test coverage scenarios that are implemented in the current release of
ACS and the scenarios that are planned for the future releases.


| TestName                                                         | Test Assertions                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | Section                           | Checked by ACS Now | Test Approach or Comments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ffa_version                                                      | The callee must take one of the following actions:<br> 1. If it supports a Firmware Framework implementation that is compatible with the version number specified by the caller, it must return the version number of the implementation.<br> 2. If it only supports a Firmware Framework implementation that is incompatible with and at a greater version number than specified by the caller, it must either return the version number of this implementation or the NOT_SUPPORTED error code.<br> 3. If it supports a Firmware Framework implementation that is incompatible with and at a lesser version number than specified by the caller, it must return the highest version number of this implementation.<br> 4. If it does not support any version of the Firmware Framework, it must return the NOT_SUPPORTED error code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 8.1.2                             | YES                | Call FFA_VERSION ABI in a loop with different input version numbers and compare the return value with expected value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | FFA_VERSION must return NOT_SUPPORTED if this function is not implemented at FF-A instance                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 8.1.2                             | NO                 | Can't simulate. Test can't generate stimulus where framework returns this error code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ffa_id_get                                                       | Must return 16-bit ID of calling FF-A component. ID value 0 must be returned at the Non-secure physical FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 8.7                               | YES                | Call FFA_ID_GET from different endpoints and compare the return ID value with expected endpoint IDs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | FFA_ID_GET must return NOT_SUPPORTED if this function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 8.7                               | NO                 | Can't simulate. Test can't generate stimulus where framework returns this error code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ffa_partition_info_get                                           | FFA_PARTITION_INFO_GET rules:<br>1. If the Nil UUID is specified at the Non-secure virtual FF-A instance, the Hypervisor must provide information for partitions resident in both Security states. <br>2. A NS-Endpoint can request information for a subset of partitions in the system by specifying the non-Nil UUID.<br>3. If the Nil UUID is specified at the Secure virtual FF-A instance, the SPM must only provide information for all SPs.<br>4. A S-Endpoint can request information for a subset of SPs in the system by specifying the non-Nil UUID.<br>5. Must return INVALID_PARAMETERS for Unrecognized UUID.<br>6. Must return BUSY if RX buffer of the caller is not free.<br>     <br> FFA_RX_RELEASE rules: Relinquish ownership of a RX buffer after reading a message from it. Returns FFA_SUCCESS without any further parameters on successful completion.<br>     <br> Manifest rules: Query endpoint discoverable manifest properties using FFA_PARTITION_INFO_GET                                                                                                                                                                                                                                                                                                                                                                    | 8.6<br>3.2<br>3.3                 | YES                | Call FFA_PARTITION_INFO_GET ABI from secure and non-secure endpoint one by one with different UUID values and expect the expected RX buffer content and return code.<br>For BUSY case, call this ABI twice back to back without releasing RX buffer for second call, and expect BUSY as return code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | FFA_PARTITION_INFO_GET rules:<br>1. Must return NOT_SUPPORTED if this function is not implemented at this FF-A instance. <br>2. Must return NO_MEMORY if Results cannot fit in RX buffer of the caller.<br>3. Must return DENIED if Callee is not in a state to handle this   request.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 8.6                               | NO                 | Can't simulate. Test can't generate stimulus where framework returns these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ffa_features                                                     | 1. If the FF-A interface that was queried is implemented, the callee completes this call with an invocation of the FFA_SUCCESS interface with provision of interface properties in the parameter registers.<br>2. If the FF-A interface that was queried is not implemented or invalid, the callee completes this call with an invocation of the FFA_ERROR interface with the NOT_SUPPORTED error code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 8.2                               | YES                | Call with FFA_FEATURES with all spec defined Function IDs one by one. <br>Expect the FFA_SUCCESS return code  and expected interface properties in parameter registers for all mandatory interfaces query and all implemented optional interfaces. <br>Expect FFA_ERROR with NOT_SUPPORTED return code for all unimplemented optional interfaces.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ffa_rx_release                                                   | Must return DENIED if Caller did not have ownership of the RX buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 8.3                               | YES                | Release Rx buffer without registering the it with the framework.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                                  | FFA_RX_RELEASE returns NOT_SUPPORTED if this function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 8.3                               | NO                 | Can't simulate. Test can't generate   stimulus where framework returns this error code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| mp_execution_contexts                                            | 1. If Endpoint is multi-processor capable with multiple execution contexts. It could run concurrently on separate PEs in the system.<br>2. In direct messaging, the Receiver could be implemented as a MP endpoint. In this case, the number of execution contexts that the endpoint implements must be equal to the number of PEs in the system. Each execution context must be pinned to a PE at system boot. This enables the SPM or Hypervisor to guarantee availability of an endpoint execution context for direct messages on the same PE as the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 2.9                               | YES                | Boot execution context setups the secondary execution contexts for VM1 and SP1 endpoints. Also perform direct messaging between these endpoints on all secondary contexts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| up_migrate_capable                                               | 1. UP endpoints must be capable of migrating and it must run only on a single PE in the system at any point of time.<br>2. In direct messaging, the Receiver could be implemented as a UP endpoint. This enables the SPM or Hypervisor to migrate the endpoint execution context  to the PE on which a direct messaging request is made.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2.9<br>4.4.1                      | YES                | Perform direct messaging between MP endpoint and UP endpoint configuration. MP endpoint make direct request with vCPU number not equal to the  UP endpoint current vCPU number. Check that before processing the message, UP endpoint is migrated to the vCPU which has made the direct request .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ffa_direct_message_32<br>ffa_direct_message_64                   | FFA_MSG_SEND_DIRECT_REQ rules:<br>1. Send a Partition message in parameter registers as a request to a target endpoint, run the endpoint and block until a response is available. Successful completion of this function can indicated through an invocation of FFA_MSG_SEND_DIRECT_RESP interface by the target endpoint to provide a response to the direct request.<br>2. Must return INVALID_PARAMETERS if Invalid endpoint ID orvnon-zero reserved register.<br>3. NOT_SUPPORTED: This function is not implemented at this FF-A instance.<br>     <br>FFA_MSG_SEND_DIRECT_RESP rules: <br>1. Send a Partition message in parameter registers as a response to a   target endpoint, run the endpoint and block until a new message is available.<br>2. Must return INVALID_PARAMETERS if Invalid endpoint ID or non-zero reserved register.<br>3. NOT_SUPPORTED: This function is not implemented at this FF-A instance.<br><br>It is invaild to call non-framework messages while processing the direct request.<br>1. FFA_YIELD rule: Must not be invoked when the caller is processing a direct request. DENIED: Callee is not in a state to handle this request.<br>2. FFA_MSG_SEND rule: Must not be invoked when the caller is processing a direct request.<br>3. FFA_MSG_POLL: Must not be invoked when the caller is processing a direct request. | 10.2<br>10.3<br>4.5.2             | YES                | Perform below steps:<br>1. Client sends the direct request to server with message in parameter registers<br>2. Server receives the direct request and compare the received message with expected values<br>3. Server calls the direct resp with different invalid input conditions and expect FFA_ERROR with INVALID_PARAMETERS return code for the call. The input conditions are same source and destination ids, wrong source and destination ids and input w2 registers with non-zero value.<br>4. Invoke non-framework ABIs while processing the direct message and expect error code for the call.<br>5. Server respond the client through direct respond with respond message in parameter registers.<br>6. Client receive the direct respond and compare the received message with expected values<br>7. Client performs the step-3 for direct request ABI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ffa_direct_message_error                                         | Relayer must ensure that target endpoint supports receipt of direct messages. Invoke FFA_ERROR with DENIED as status if this is not the case.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 10.2.1.2                          | YES                | Send direct request to the endpoint which doesn't support the receipt of the direct   request, and expect FFA_ERROR with DENIED as return code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ffa_direct_message_error1                                        | An attempt to send a direct message to a VM that only supports indirect messaging must be rejected by the Hypervisor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 4.3.1                             | YES                | Send direct request to the endpoint which only support indirect messaging, and expect FFA_ERROR with DENIED as return code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | FFA_MSG_SEND_DIRECT_REQ rules: Returns BUSY if Message target is busy. Returns ABORTED if Message target ran into an unexpected error and has aborted.<br>FFA_MSG_SEND_DIRECT_RESP rule: Returns BUSY if Message target is busy.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 10.2<br>10.3                      | NO                 | Can't simulate. Test can't generate stimulus where framework returns these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | FFA_MSG_SEND_DIRECT_REQ rule: Returns FFA_INTERRUPT to indicate that the direct request was interrupted and must be resumed through the FFA_RUN interface.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 10.2                              | NO                 | Perform below steps:<br>1. Allocate RX and TX memory and register using ffa_rxtx_map() from VM and SP.<br>2. Fill the payload into parameter registers and send ffa_msg_send_direct_req() from VM to SP0.<br>3. Process the messgae in SP0 and generate NS physical interrupt.<br>4. SPMC save the SP0 state and send ffa_interrupt() to VM.<br>5. Handle the interrupt in VM and VM migrates to another PE.<br>6. VM resumes SP execution using ffa_run().<br>7. SPMC restores SP state and and resumes SP execution.<br>8. SP completes the message processing and send response back to VM using ffa_msg_send_direct_resp().<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | It is allowed to send direct Partition message request to an endpoint while processing the direct messaging                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 4.5.2                             | YES                | There is no explicit test written for this rule. It is covered in the ACS test framework as the it is built using direct messaging ABIs and ffa_msg_wait ABI. A successful launch and run of test partition code indirectly verifies this rule.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Partition  manager must validate that the Sender is allowed to send direct request. Invoke FFA_ERROR with NOT_SUPPORTED as status if this is not the case.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 10.2.1.2                          | NO                 | Call DIRECT_REQ from endpoint which only supports the indirect messaging                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | Partition manager must validate that the Sender is allowed to send direct respond. Invoke FFA_ERROR with NOT_SUPPORTED as status if this is not the case.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 10.3.1.2                          | NO                 | Call DIRECT_RESP from endpoint   which only supports the indirect messaging                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                                  | Send of direct respond to the target endpoint which supports only indirect message or direct respond must be rejected with DENIED status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 10.3.1.2                          | NO                 | Try to send direct respond to the target which support only indirect message. Check for DENIED status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                                  | FFA_MSG_SEND_DIRECT_RESP rule: The call is interrupted by an interrupt targeted to the caller.<br>FFA_MSG_WAIT Rule: The call is interrupted by an interrupt targeted to the caller.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 10.3<br>9.1                       | NO                 | Generates interrupt targeted to SP1-UP endpoint while SP1 is waiting for message through these ABIs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | FFA_MSG_WAIT rule: Blocks the caller until a message is available in the parameter registers of   the caller.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 9.1                               | YES                | There is no explicit test written for this rule. It is covered in the ACS test harness as the test harness is built using direct messaging abi and ffa_msg_wait abi. A successful launch and run of test partition code indirectly verifies it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ffa_msg_send                                                     | FFA_MSG_SEND rules: Send a Partition   message to a VM through the RX/TX buffers by using indirect messaging. Successful completion of this function call is indicated as w0 contains FFA_SUCCESS function ID and w1/x1-w7/x7 are reserved and MBZ.<br>FFA_MSG_SEND_DIRECT_RESP rules: Blocks the caller until A message is available in the RX buffer of the caller.<br>FFA_MSG_WAIT rules: Blocks the caller until A message is available in the RX buffer of the caller. Returns INVALID_PARAMETERS: Unrecognized endpoint or vCPU ID specified at Non-secure physical or virtual FF-A instance.<br>FFA_RX_RELEASE rules: Relinquish ownership of a RX buffer after reading a message from it. Returns FFA_SUCCESS without any further parameters on successful completion.<br>FFA_RXTX_MAP rules: Maps the RX/TX buffer pair in the translation regime of the callee on behalf of an endpoint. Returns FFA_SUCCESS without any further parameters on successful completion. <br>FFA_RXTX_UNMAP rules: Unmaps the RX/TX buffer pair of an endpoint or Hypervisor from the translation regime of the callee. Returns FFA_SUCCESS without any further parameters on successful completion.                                                                                                                                                                   | 10.1<br>10.3<br>9.1<br>8.4<br>8.5 | YES                | 1. Server is blocked through FFA_MSG_SEND_DIRECT_RESP call. Client sends the indirect message to server with message content in TX buffer<br>2. Server gets unblocked, it processes the message, relinquish ownership of the RX buffer and calls FFA_MSG_WAIT to wait for next message.<br>3. Client again sends the indirect message to server with same message content in TX buffer.<br>4. Server gets unblocked, it processes the message, checks invalid input conditions for FFA_MSG_WAIT and at the end it relinquishes ownership of the RX buffer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ffa_msg_send_error                                               | An attempt to send an indirect message to an endpoint that only supports receipt of direct requests must be rejected                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 4.4.1                             | YES                | Send indirect message to endpoint which only supports receipt of direct requests                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                                  | FFA_MSG_SEND rules: <br>1. Returns INVALID_PARAMETERS if A field in input parameters is incorrectly encoded. <br>2. Returns BUSY if Receiver RX buffer is not free. <br>3. Returns DENIED if Callee is not in a state to handle this request. <br>4. Returns NO_MEMORY if Insufficient memory to handle this request. <br>5. Returns NOT_SUPPORTED if this function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 10.1                              | NO                 | 1. Allocate RX and TX memory and register using ffa_rxtx_map().<br>2. Pass invalid sender and receiver ids to ffa_msg_send() and check for INVALID_PARAMETERS status code.<br>3. Pass invalid flag parameter to ffa_msg_send() and check for INVALID_PARAMETERS   status code.<br>4. Check reserved and unused parameter registers are 0 and check for INVALID_PARAMETERS status code if fails.<br>5. NOT_SUPPORTED: This function is not implemented at this FF-A   instance.<br>6. check that reserved and unused parameter registers are 0. Return INVALID PARAMETER if this check fails.<br>7. check that the size of the Receivers RX buffer is large enough to accommodate the message. Must return NO_MEMORY if this is not true.<br>8. Try to invoke ffa_msg_send while processing the direct request and check for FFA_ERROR status code.<br>9. BUSY: Receivers RX buffer is not free.<br>10. DENIED: Callee is not in a state to handle this request.<br>11. Must protect RX buffer of Receiver from concurrent accesses.<br>12. Try to send indirect message between VM and SP, check for error status code.<br>13. Try to send indirect message between SP and SP, check for error status code.<br>14. Try to send indirect message between SP and VM, check for error status code.<br>15. Try to send indirect message from VM to Hypervisor and SPM. check for error status code<br>16. Try to send indirect message from Sp to Hypervisor and SPM. check for error status code                                                                                                                                                                                                                                                           |
|                                                                  | VM can request to be notified when the RX buffer becomes available again by setting bit[0] = 1 in the Flags parameter.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 10.1.1                            | NO                 | 1. Client sends the twice indirect messages with setting bit[0] = 1 in the Flags   parameter to server<br>2. Server receive the first indirect message and  isn't release the RX buffer<br>3. Client to expect BUSY error code for second indirect message.<br>4. Server to release rx buffer<br>5. Client to receive availability interrupt as an notification for rx buffer availability                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | FFA_MSG_WAIT rule: Returns DENIED if Callee is   not in a state to handle this request.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 9.1                               | NO                 | Call FFA_MSG_WAIT while processing the direct message                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | 1. The size of the RX and TX buffers in a pair must be the same and a multiple of the larger translation granule size used by the FF-A components at an FF-A instance.<br>2. The alignment of the RX and TX buffers in a pair must be equal to the larger translation granule size used by the FF-A components at an FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 4.2.2.3                           | NO                 | 1. Call FFA_RXTX_MAP ABI with RX, TX buffers alignment not equal to  larger translation granule size used by the FF-A instance.<br>2. Call FFA_RXTX_MAP ABI with RX, TX buffers size not equal to multiple of larger translation granule size used by the FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | FFA_RXTX_MAP rule: <br>1. Returns INVALID_PARAMETERS: One or more fields in input parameters is incorrectly encoded.<br>2. Returns NO_MEMORY for Not enough memory to map the buffers in the translation   regime of the callee. or Not enough memory in TX buffer of Hypervisor to   describe caller buffer pair to SPM.<br>3. Returns DENIED: Buffer pair already registered for the FF-A component with specified ID.<br>4. Returns NOT_SUPPORTED: This function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 8.4                               | NO                 | Call FFA_RXTX_MAP with input conditions that can simulate these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_RXTX_MAP: Both Hypervisor and SPM must ensure the caller has exclusive access and ownership of the RX/TX buffer memory regions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 8.4                               | NO                 | Try to map RX,TX buffer pair with addresses that are not belong to endpoint.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_RXTX_UNMAP rules:<br>1. Returns INVALID_PARAMETERS   when There is no buffer pair registered on behalf of the caller.<br>2. Returns NOT_SUPPORTED when this function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 8.5                               | NO                 | Call FFA_RXTX_UNMAP with input conditions that can simulate these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | Donate memory from the sender to the receiver and ensure it is not possible to access memory surrounding the received memory in both single constituent and multiple constituent modes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 5.1                               | NO                 | 1. Allocate   RX and TX memory and register using ffa_rxtx_map() from sender and target   endpoint.<br>2. Allocate the memory and Fill the transaction details as described in  a memory transaction descriptor<br>3. Fill the total length, fragment length, address and page count parameters and call ffa_mem_donate().<br>4. Get Handle as a return parameter upon the successful completion.<br>5. Send handle and owner endpoint id to receiver endpoint using ffa_msg_send_direct_req().<br>6. Receive the handle from the receiver endpoint and map the memory regions into receiver translation regime using ffa_mem_retrieve_req() and check for  FFA_SUCCESS status code.<br>7. Setup the data abort exception handler.<br>8. Try to access the memory regions lower and upper boundaries from receiver endpoint. This will trigger data abort exception.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | Relayer must ensure that only the amount of data as specified by the length is sent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 10.1.2.2                          | NO                 | 1. Allocate RX and TX memory and register   using ffa_rxtx_map() from VM0 and VM1.<br>2. Fill the payload messgae into the TX buffer.<br>3. Fill valid sender(VM0), receiver ids(VM1).<br>4. Fill message length parameter to hardcoded value.<br>5. Set bit[0] = 0 in the flag parameter and call ffa_msg_send() abi from   VM0.<br>6. Schedule the receiver endpoint(VM1) using ffa_run() from PVM.<br>7. Receiver endpoint start running and check the expected messgae with   hardcoded length value.<br>8. Unmap the TX and RX memory using ffa_rxtx_unmap() from VM0 and VM1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | A message larger than the mailbox size should not be able to be sent.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 10.1.2.2                          | NO                 | 1. Allocate   RX and TX memory and register using ffa_rxtx_map() from VM0 and VM1.<br>2. Fill the payload messgae into the TX buffer.<br>3. Fill valid sender(VM0), receiver ids(VM1).<br>4. Fill message length parameter to more than TX buffer.<br>5. Set bit[0] = 0 in the flag parameter and call ffa_msg_send() abi from   VM0 and check for INVALID_PARAMETERS status code.<br>6. Unmap the TX and RX memory using ffa_rxtx_unmap() from VM0 and VM1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Share memory region to others and then attempt to share the part of the region to one of the party                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 11.3                              | NO                 | 1. Share the memory region from EP A to other endpoints. Try to share the part of memory to another endpoint and  check for error status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | Share the memory in the TX buffer to another EP, corrupt the sender TX buffer and the schedule the receiver.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 4.2                               | NO                 | 1. Share the   memory from endpoint A to B. Corrupt the sender TX buffer before scheduling   the receiver.<br>2. Schedule the Receiver and validate the transaction descriptor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | FFA_YIELD Rules: Relinquish execution back to the scheduler on current physical CPU from the calling VM. Successful completion of this function is indicated through an invocation of the following functions by the callee:<br>  FFA_RUN to indicate that the execution context of the VM has been scheduled by the primary scheduler.<br>  FFA_INTERRUPT to indicate that the call was interrupted.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 9.2                               | NO                 | 1. Send indirect message between two endpoints. <br>2. Receiver to relinquish control back to the scheduler<br>3. Client to send another indirect message to receiver to unblock the execution                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | FFA_YIELD rules: <br>1. INVALID_PARAMETERS: Unrecognized endpoint or vCPU ID. Only valid with the ERET conduit.<br>2. NOT_SUPPORTED: This function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 9.2                               | NO                 | Call this ABI with input conditions that can simulate these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | FFA_RUN rules: <br>1. INVALID_PARAMETERS: Unrecognized endpoint or vCPU ID. <br>2. NOT_SUPPORTED: This function is not implemented at this FF-A instance, the SPM and Hypervisor must return NOT_SUPPORTED if an endpoint invokes this interface when it only supports indirect messaging and does not implement the primary scheduler. <br>3. DENIED: Callee is not in a state to handle this request.<br>4. BUSY: vCPU is busy and caller must retry later., the SPM and Hypervisor must return BUSY if an endpoint invokes this interface when the specified vCPU of the endpoint is busy processing a request on another PE.<br>5. ABORTED: vCPU or VM ran into an unexpected error and has aborted.<br>     <br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 9.3                               | NO                 | Call this ABI with input conditions that can simulate these error codes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | FFA_NORMAL_WORLD_RESUME: Request SPMD to resume execution of Normal world on current PE.Returns DENIED if Callee is not in a state to handle this request.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 9.4                               | NO                 | Can't simulate. Test can't generate stimulus as test is designed to run at partition. However, it  is assumed that this interface would be exercised by SPMC during direct message preemption  testing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | FFA_NORMAL_WORLD_RESUME: The partition  manager must return NOT_SUPPORTED if this function is invoked at an interface  other than secure physical instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 9.4                               | NO                 | 1. Query this interface using FFA_FEATURES from endpoint and expect this return code<br>2. Invoke this interface from endpoint and expect this return code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | FFA_MSG_POLL rule:<br>1. Poll if a message is available in the RX buffer of the caller. Execution is returned to the caller if no message is available. Successful completion of this function is indicated through the invocation of the FFA_MSG_SEND interface.<br>2. RETRY: Message is not available in the callers RX buffer.<br>3. NOT_SUPPORTED: This function is not implemented at this FF-A instance.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 10.4                              | NO                 | Try to receiver indirect message through FFA_MSG_POLL ABI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                  | The MMU must be disabled for a partition that does not run in S-EL0 in either Execution state. The MMU must be enabled for S-EL0 partition that runs in either Execution state.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 3.5.1                             | YES                | No explicit test. Rule is verified by the test framework during test partition boot entry. Failing to provide this will hang the partition.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                                  | If a physical interrupt must be handled in another FF-A component, the SPM or the Hypervisor must notify the preempted endpoint that a managed exit is required.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 4.5.4                             | NO                 | 1. Allocate   RX and TX memory and register using ffa_rxtx_map() from VM and SPs.<br>2. Fill the payload into parameter registers and send   ffa_msg_send_direct_req() from VM to SP0.<br>3. Process the messgae in SP0 and generate NS physical interrupt.<br>4. SPMC save the SP0 state and masks NS interrupt. To trigger managed exit SPMC triggers virtual interrupt.<br>5. SPMC resumes SP0 execution using eret.<br>6. Handle the virtual interrupt in SP0.<br>7. Inform VM about managed exit in message using ffa_msg_send_direct_resp() from SP0 to VM.<br>8. SPMC unmask the NS physical interrupt and send response to VM.<br>9. Handle the interrupt in VM and VM migrates to another PE and starts executing from migrated PE.<br>10. VM resume the execution and send ffa_msg_send_direct_req() from VM to SP1 and check for FFA_SUCCESS status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | A partition requests ownership and exclusive access to the MMIO region of a device during boot time. The corresponding partition manager assigns the MMIO region to the partition.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 2.10                              | YES                | No explicit test. SP1 and NS-endpoint-1 test partitions request the UART access through manifests. Assigning UART to endpoint and accessing the UART MMIO region after loading the partition is implicitly verifies this rule                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                                  | One or more partitions request access to the MMIO region of a device during boot time. The corresponding partition manager is the Owner of the MMIO region and   grants access to all the partitions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 2.10                              | NO                 | Try to share MMIO region between endpoint using manifest parameter. And check that all required endpoint has access to it.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ffa_mem_donate_mmio                                              | This version of the Framework does not permit, Ownership of a device MMIO region to be transferred to another partition during run-time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 2.10                              | YES                | Try to donate MMIO region during runtime to an another endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ffa_mem_share_mmio                                               | This version of the Framework does not permit access to a device MMIO region to be granted to another partition during run-time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2.10                              | YES                | Try to share MMIO region during runtime to an another endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ffa_mem_lend_mmio                                                | This version of the Framework does not permit access to a device MMIO region to be granted to another partition during run-time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 2.10                              | YES                | Try to lend MMIO region during runtime to an another endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ffa_mem_share                                                    | FFA_MEM_SHARE Rules: Starts a transaction to grant access to a memory region to Borrower.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 11.3                              | YES                | 1. Client and   server setups the rxtx buffer pair<br>2. Client starts to share the its own memeory region with server using   FFA_MEM_SHARE ABI<br>3. Client shares the handle with server using direct messaging. Serve uses   this handle value during mem_retrive call.<br>4. Server checks the accessibility to the share region<br>5. Server relinquishes the memory and notifies the sender.<br>6. Client reclaims the memory region back                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                                                                  | Managed exit mechanism can be used by an endpoint only if it fulfills the following   constraints:<br>1. The endpoint is capable of receiving direct requests<br>2. The endpoint runs in a privileged exception level. This is one of the following.<br>      EL1<br>      Secure EL1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 4.5.4                             | NO                 | 1. Check the endpoint capable of receiving direct requests using ffa_partition_info_get() and check bit[0] == 1 for support receiving of direct request.<br>2. Read the current el from the endpoint, it should be EL1 or S-EL1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                                  | MEM_DONATE: State machine - The FF-A shall ensure that only the owner with exclusive access to a memory region can donate its ownership to only one endpoint in the system.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 5.6.1                             | NO                 | 1. Lend memory from EP A to other endpoints   and Try to donate the same memory from A to B. Check for error status code.<br>2. lend the memory from EP A to B and other endpoints. Try to donate same memory A to B and check for error status code.<br>3. Share the memory from EP A to other endpoints. Try to donate same memory from A to B an d check for error status code.<br>4. Share the memory from EP A to B and other endpoints. Try to donate same memory from A to B an d check for error status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_LEND: State machine - The FF-A shall ensure that only the owner with exclusive access to a memory region can lend access to one or more borrowers in the system                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 5.7.1                             | NO                 | 1. Lend the memory from EP A to B and other endpoints. Check for FFA_SUCCESS status code.<br>2. Try to lend same memory from EP A   to B and check for error status code.<br>3. Lend the memory from EP A to other endpoints. Try to lend same memory from EP A to B and check for error status code.<br>4. Lend the memory from EP A to B. Try to lend the same memory from EP A to B and check for error status code.<br>5. Lend the memory from EP A to B and other endpoints. Try to lend same memory from EP A to B and check for error status code.<br>6. Share the memory from EP A to other endpoints. Try to lend same memory from EP A to B and check for error status code.<br>7. Share the memory from EP A to B and other endpoints. Try to lend same memory from EP A to B and check for error status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                                  | MEM_SHARE: State machine- The FF-A shall ensure that only the owner with exclusive access to a memory region can grant or share access to one or more borrowers in the system.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5.8.1                             | NO                 | 1. Share the memory from EP A to B and   other endpoints. Check for success code.<br>2. Lend the memory from EP A to other endpoints. Try to share same memory from EP A to B and check for error status code.<br>3. Lend the memory from EP A to B endpoints. Try to share same memory from EP A to B and check for error status code.<br>4. Lend the memory from EP A to B and other endpoints. Try to share same memory from EP A to B and check for error status code.<br>5. Share the memory from EP A to other endpoints. Try to share same memory from EP A to B and check for error status code.<br>6. Share the memory from EP A to B and other endpoints. Try to share same memory from EP A to B and check for error status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Relinquish and reclaim memory state machine: The FF-A shall ensure that only the borrowers of a memory region can relinquish access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 5.9.1                             | NO                 | 1. Try to   relinquish the endpoint A owned memory from the endpoint B and check for   error status code. <br>2. Lend the memory from EP A to other endpoints. Try to relinquish the same   memory from EP B and check for error status code.<br>3. Lend the memory from EP A to B and other endpoints. Try to relinquish the same memory from EP B   and all borrowers. Reclaim back from the owner and make sure that owner has exclusive access.<br>4.  Share the memory from EP A to other endpoints. Try to relinquish the same memory from EP B and check for   error status code.<br>5. Share the  memory from EP A to B and other endpoints. Try to relinquish the same memory from EP B and all borrowers. Reclaim back from the owner and  make sure that owner has exclusive access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | FFA_MEM_LEND: Read-write permission has precedence over Read-only permission.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 6.11.2                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the memory access permissions bits[1:0] = 0x2 read and write in the   memory access permission descriptor.<br>     3. Lend the memory from A to B.<br>     4. Fill the handle, tag, flags and other transaction details as described   in  a memory transaction descriptor   (see Table 45) from endpoint B.<br>     5. Fill the memory access permissions bits[1:0] = 0x1 read only in the memory access permission descriptor.<br>     6. Retrevie the memory region from the endpoint B. check for FFA_SUCCESS status code.<br>     7. Try to read the retreived the memory region from the endpoint B. <br>     8. Try to write the retreived memroy region and check for data abort exception.<br>     9. Relinquish the same memory from endpoint B. <br>     10. Reclaim the memory from the owner enpoint A.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ffa_mem_share_32_read_only_chk<br>ffa_mem_share_64_read_only_chk | FFA_MEM_SHARE: Read-write permission has precedence over Read-only permission.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5.11.2                            | YES                | Follow the above test approach and use FFA_MEM_SHARE instead of FFA_MEM_LEND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | MEM_DONATE: Data access permissions usage - If the Receiver is a PE or Proxy endpoint, the Owner must not specify the level of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 5.11.2                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor  in TX buffer.<br>     2. Fill the memory access permissions bits[1:0] = 0x1 read only in the   memory access permission descriptor.<br>     3. Fill the total length, fragment length, address=0 and page count=0   parameters and donate the  memory using   ffa_mem_donate() from endpoint A to endpoint B(PE or proxy endpoint).<br>     4. Check for INVALID_PARAMETERS status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                  | MEM_DONATE: Data access permissions usage - If the Receiver is an independent peripheral device, the Owner could specify the level of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 5.11.2                            | NO                 | Can't   simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  | Only XN permission must be used in the transaction to lend memory to more than one Borrower                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 5.11.3                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the memory access permissions bits[3:2] = 0x0 in the memory access   permission descriptor.<br>     3. Lend the  memory using   ffa_mem_lend() from endpoint A to multiple endpoints.<br>     4. Fill the memory access permissions bits[3:2] = 0x2  in the memory access permission   descriptor.<br>     5. Lend the  memory using   ffa_mem_lend() from endpoint A to multiple endpoints and check for FFA_ERROR   status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Only XN permission must be used in the transaction to share memory to more than one Borrower                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 5.11.3                            | NO                 |     1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the memory access permissions bits[3:2] = 0x0 in the memory access   permission descriptor.<br>     3. Share the  memory using   ffa_mem_lend() from endpoint A to multiple endpoints.<br>     4. Fill the memory access permissions bits[3:2] = 0x2  in the memory access permission   descriptor.<br>     5. Share the  memory using   ffa_mem_lend() from endpoint A to multiple endpoints and check for FFA_ERROR   status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
|                                                                  | In a transaction to donate memory to a single Borrower: If the Receiver is a PE or Proxy endpoint, the Owner must not specify the level of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 5.11.3                            | NO                 |      1. Allocate the memory region and Fill the transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the instruction access permissions bits[3:2] = 0x2 in the memory   access permission descriptor.<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and donate the  memory using   ffa_mem_donate() from endpoint A to endpoint B.<br>     3. Check for INVALID_PARAMETRES status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | In a transaction to lend memory to a single Borrower: If the Receiver is a PE or Proxy endpoint, the Owner must not specify the level of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 5.11.3                            | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the instruction access permissions bits[3:2] = 0x2 in the memory   access permission descriptor.<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and donate the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     3. Check for INVALID_PARAMETRES status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | In a transaction to donate memory to a single Borrower: If the Receiver is an independent peripheral device, the Owner could   specify the level of access. Use the permission specified by the Owner to map the memory region into the devices address space.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 5.11.3                            | NO                 | Can't simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | In a transaction to lend memory to a single Borrower: If the Receiver is an independent peripheral device, the Owner could   specify the level of access.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 5.11.3                            | NO                 | Can't   simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  | MEM_LEND: The Relayer must validate the permission specified by the Receiver to ensure that it is the same or has lesser precedence than the permission determined by the Relayer. Check for Not Execute(sender)  -->   Execute(borrower)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 5.11.3                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the memory region attributes bits[5:4] = 0x2 in the memory region   attribute descriptor.<br>     2. Fill the instruction access permissions bits[3:2] = 0x1 in the memory   access permission descriptor.<br>     3. Lend the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     4. Fill the instruction access permissions bits[3:2] = 0x2 in the memory   access permission descriptor..<br>     5. Fill the total length, fragment length, address and page count   parameters and retrevie the memory region using  ffa_mem_retrieve_req() from the endpoint B.   check for FFA_ERROR status code. <br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_LEND: The Relayer must validate the permission specified by the Receiver (if a PE   or Proxy endpoint) to ensure that it is the same or has lesser precedence than the permission determined by the Relayer. Check for Execute(sender)  --> Not Execute(borrower).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 5.11.3                            | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the memory region attributes bits[5:4] = 0x2 in the memory region   attribute descriptor.<br>     3. Fill the instruction access permissions bits[3:2] = 0x2 instruction   access permission descriptor.<br>     4. Lend the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     5. Fill theinstruction access permissions bits[3:2] = 0x1 in the   instruction access permission descriptor.<br>     6. Retrevie the memory region using    ffa_mem_retrieve_req() from the endpoint B.<br>     7. Try excute the instructions from the retrived memory region and check   for instruction abort.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | MEM_DONATE: The Relayer must validate the permission specified by the Receiver to ensure that it is the same or has lesser precedence than the permission   determined by the Relayer.<br>     Check for Not Execute(sender)  -->   Execute(borrower)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 5.11.3                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_DONATE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | MEM_DONATE: The Relayer must validate the permission specified by the Receiver to  ensure that it is the same or has lesser precedence than the permission   determined by the Relayer.<br>     Check for Execute(sender)  --> Not   Execute(borrower)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | 5.11.3                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_DONATE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  |  MEM_LEND: Memory region attributes usage- The precedence rules for memory types are as follows. < should be read as has less precedence than.<br> Device-nGnRnE < Device-nGnRE < Device-nGRE < Device-GRE < Normal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 5.11.4                            | NO                 |      1. Verify ffa_mem_lend abi and following   attributes from the sender and borrower.<br>     2. Sender: bits[5:4]=0x1, bits[3:2]=0, Receiver bits[5:4]=0x1,   bits[3:2]=0x1 and check for FFA_ERROR status code.<br>     3. Sender: bits[5:4]=0x1, bits[3:2]=0, Receiver bits[5:4]=0x1,   bits[3:2]=0x2 and check for FFA_ERROR status code.<br>     4. Sender: bits[5:4]=0x1, bits[3:2]=0, Receiver bits[5:4]=0x1,   bits[3:2]=0x3 and check for FFA_ERROR status code.<br>     5. Sender: bits[5:4]=0x1, bits[3:2]=1, Receiver bits[5:4]=0x1,   bits[3:2]=0x0 and check for FFA_SUCCESS status code.<br>     6. Sender: bits[5:4]=0x1, bits[3:2]=1, Receiver bits[5:4]=0x1,   bits[3:2]=0x2 and check for FFA_ERROR status code.<br>     7. Sender: bits[5:4]=0x1, bits[3:2]=1, Receiver bits[5:4]=0x1,   bits[3:2]=0x3 and check for FFA_ERROR status code.<br>     9. Sender: bits[5:4]=0x1, bits[3:2]=2, Receiver bits[5:4]=0x1,   bits[3:2]=0x1 and check for FFA_SUCCESS status code.<br>     10. Sender: bits[5:4]=0x1, bits[3:2]=0x3, Receiver bits[5:4]=0x1,   bits[3:2]=0x2 and check for FFA_SUCCESS status code.<br>     11. Sender: bits[5:4]=0x1, bits[3:2]=0x2, Receiver bits[5:4]=0x1,   bits[3:2]=0x3 and check for FFA_ERROR status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                                  | MEM_LEND: Memory region attributes usage: The precedence rules  for   Cacheability attribute are as follows.<br>Non-cacheable < Write-Back Cacheable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 5.11.4                            | NO                 |      1. Verify   ffa_mem_lend abi and following attributes from the sender and borrower.<br>     2. Sender: bits[5:4]=0x2, bits[3:2]=1, Receiver bits[5:4]=0x2,   bits[3:2]=0x3 and check for FFA_ERROR status code.<br>     3. Sender: bits[5:4]=0x2, bits[3:2]=0x3, Receiver bits[5:4]=0x1,   bits[3:2]=0x1 and check for FFA_SUCCESS status code.<br>     4. Sender: bits[5:4]=0x1, bits[3:2]=0 check for FFA_ERROR status code. Receiver bits[5:4]=0x1,   bits[3:2]=0x2 and check for FFA_ERROR status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | MEM_LEND: Memory region attributes usage - Shareability attribute - The precedence rules are as follows.<br>Non-Shareable < Inner Shareable < Outer shareable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 5.11.4                            | NO                 |      1. Verify ffa_mem_lend abi and following   attributes from the sender and borrower.<br>     2. Sender: bits[5:4]=0x2, bits[1:0]=0, Receiver bits[5:4]=0x2,   bits[1:0]=0x2 and check for FFA_ERROR status code.<br>     3. Sender: bits[5:4]=0x2, bits[1:0]=0x1, Receiver bits[5:4]=0x1,   bits[1:0]=0x2 and check for FFA_ERROR status code.<br>     4. Sender: bits[5:4]=0x1, bits[1:0]=2, Receiver bits[5:4]=0x1,   bits[1:0]=0x1 and check for FFA_SUCCESS status code.<br>     5. Sender: bits[5:4]=0x1, bits[1:0]=3, Receiver bits[5:4]=0x1,   bits[1:0]=0x2 and check for FFA_SUCCESS status code.<br>     6. Sender: bits[5:4]=0x1, bits[1:0]=3, Receiver bits[5:4]=0x1,   bits[3:2]=0x1 and check for FFA_SUCCESS status code.<br>     7. Sender: bits[5:4]=0x1, bits[1:0]=3, Receiver bits[5:4]=0x1,   bits[3:2]=0x0 and check for FFA_SUCCESS status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | MEM_SHARE: Memory region attributes usage - The precedence rules for memory types are as follows. < should be read   as has less precedence than.<br>Device-nGnRnE < Device-nGnRE < Device-nGRE < Device-GRE <   Normal                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 5.11.4                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | MEM_SHARE: Memory region attributes usage: The precedence rules  for   Cacheability attribute are as follows.<br>Non-cacheable < Write-Back Cacheable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 5.11.4                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | MEM_SHARE: Memory region attributes usage: Shareability attribute - The precedence rules are as follows.<br>Non-Shareable < Inner Shareable < Outer shareable                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 5.11.4                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | MEM_LEND: Memory region attributes usage: In a transaction to lend memory to a single Borrower, If the Receiver is a PE or Proxy endpoint, the Owner must not specify the   attributes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 5.11.4                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the memory region attributes bits[5:4] = 0x2 in the memory region   attribute descriptor.<br>     3. Fill the total length, fragment length, address=0 and page count=0   parameters and lend the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     4. Check for INVALID_PARAMETERS status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | MEM_LEND: Memory region attributes usage: In a transaction to donate memory or lend memory to a single Borrower, If the Receiver is an independent peripheral device, the Owner could   specify the attributes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 5.11.4                            | NO                 | Can't simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | MEM_DONATE: Memory region attributes usage: In a transaction to donate memory or lend memory to a single Borrower, If the Receiver is a PE or Proxy endpoint, the Owner must not specify the   attributes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 5.11.4                            | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_DONATE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | MEM_DONATE: Memory region attributes usage - In a transaction to donate memory or lend memory to a single   Borrower, If the Receiver is an independent peripheral device, the Owner could   specify the attributes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 5.11.4                            | NO                 | Can't simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | MEM_DONATE: Handle - Ensure that the Handle was allocated to the Owner specified in the Sender endpoint ID field of the transaction descriptor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5.12.1                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Donate the  memory using ffa_mem_donate()   from endpoint A to endpoint B.<br>     3. Fill the handle, tag, flags and other transaction details as described   in  a memory transaction descriptor   (see Table 45).<br>     4. Fill the invalid sender endpoint in the transaction descriptor.<br>     5. Fill the total length, fragment length, address and page count   parameters and retrive the memory region using  ffa_mem_retrieve_req() from the endpoint B.   check for FFA_ERROR status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|                                                                  | MEM_LEND: Handle - Ensure that the Handle was allocated to the Owner specified in the Sender   endpoint ID field of the transaction descriptor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5.12.1                            | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ffa_mem_share_handle                                             | MEM_SHARE: Handle - Ensure that the Handle was allocated to the Owner specified in the Sender   endpoint ID field of the transaction descriptor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 5.12.1                            | YES                | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_DONATE: Tag - The Relayer must ensure the Tag value specified by the Receiver is equal to   the value that was specified by the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 5.12.1                            | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Donate the  memory using ffa_mem_donate()   from endpoint A to endpoint B.<br>     3. Fill the handle, flags and other transaction details as described   in  a memory transaction descriptor   (see Table 45).<br>     4. Fill the invalid tag in  a memory   transaction descriptor.<br>     5. Fill the total length, fragment length, address and page count   parameters and retrevie the memory region using  ffa_mem_retrieve_req() from the endpoint B.   check for FFA_ERROR status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ffa_mem_share_tag                                                | MEM_SHARE: Tag - The Relayer must ensure the Tag value specified by the Receiver is equal to   the value that was specified by the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 5.12.1                            | YES                | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_LEND: The Relayer must ensure the Tag value specified by the Receiver is equal to   the value that was specified by the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 5.12.1                            | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | MEM_SHARE: Endpoint memory access descriptor array   usage:<br>A Sender must describe the memory region in a composite memory region   descriptor (see Table 39) with the following non-exhaustive list of   checks.<br><br>- Ensure that the address ranges specified in the composite memory region descriptor do not overlap each other.<br>- Total page count is equal to the sum of the Page count fields in each Constituent memory region descriptor.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 5.12.3                            | NO                 |      1. Allocate the memory region and  Fill the Total page count, Address range   count and Address range array in the multiple Composite memory region   descriptors<br>     2. Fill the overlap address ranges in the Composite memory region   descriptor.<br>     3. Fill the Address and page count in the Table 40: Constituent memory   region descriptor. <br>     4. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     5. Fill the total length, fragment length, address=0 and page count=0   parameters and share the  memory using   ffa_mem_share() from endpoint A to endpoint B. check for FFA_ERROR status code.<br>     6. Repeat same experiment by filling invaild Total length parameter and   check for INVALID_PARAMTERS status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | In a FFA_MEM_DONATE invocation,<br> The Endpoint memory access descriptor count field in the transaction descriptor must be set to 1. This implies that the Owner must specify a   single Receiver endpoint in a transaction to donate memory.<br> The Offset field of the Endpoint memory access descriptor must be set to the offset of the composite memory region descriptor                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 5.12.3                            | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Set the endpoint memory access descriptor count to two in the transaction   descriptor and donate the memory region, check for FFA_ERROR status   code.<br>     3. set the invalid offset field of the endpoint memory access descriptor   and check for FFA_ERROR status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | In a FFA_MEM_LEND invocation:<br> The Endpoint memory access descriptor count field in the transaction descriptor must be set to a non-zero value. This implies that the Owner must   specify at least a single Borrower endpoint in atransaction to lend or share   memory.<br> The Offset field in the Endpoint memory access descriptor of each Borrower must be set to the offset of the composite memory region descriptor.   This implies that all values of the Offset field must be equal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 5.12.3                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Set the endpoint memory access descriptor count to zero in the transaction   descriptor and lend the memory, check for FFA_ERROR status code.<br>     3. set the invalid offset field of the endpoint memory access descriptor   from the borrower side and check for FFA_ERROR status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  | In a FFA_MEM_SHARE invocation:<br> The Endpoint memory access descriptor count field in the transaction descriptor must be set to a non-zero value. This implies that the Owner must   specify at least a single Borrower endpoint in atransaction to lend or share   memory.<br> The Offset field in the Endpoint memory access descriptor of each Borrower must be set to the offset of the composite memory region descriptor.   This implies that all values of the Offset field must be equal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 5.12.3                            | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_DONATE: Relayer usage - It must ensure that the Endpoint ID field in each Memory access permissions   descriptor specifies a valid endpoint. The Relayer must return   INVALID_PARAMETERS in case of an error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 5.12.3                            | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the invalid endpoint id in the memory access permissions descriptor.<br>     3. Fill the total length, fragment length, address=0 and page count=0   parameters and donate the  memory using   ffa_mem_donate() from endpoint A to multiple endpoints.<br>     4. Check for INVALID_PARAMETERS status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_SHARE: Relayer usage - It must ensure that the Endpoint ID field in each Memory access permissions   descriptor specifies a valid endpoint. The Relayer must return   INVALID_PARAMETERS in case of an error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 5.12.3                            | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | MEM_LEND: Relayer usage - It must ensure that the Endpoint ID field in each Memory access permissions   descriptor specifies a valid endpoint. The Relayer must return   INVALID_PARAMETERS in case of an error.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 5.12.3                            | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ffa_mem_share_retrieve                                           | MEM_SHARE: Relayer usage - In an invocation of the FFA_MEM_RETRIEVE_REQ ABI, If the Receiver specifies the address ranges that must be used to map the   memory region in its translation regime, the Relayer must ensure that the   size of the memory region is equal to that specified by the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 5.12.3                            | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Share the  memory using ffa_mem_share()   from endpoint A to B.<br>     3. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer from the borrower side.<br>     4. Retrive the memory region using ffa_mem_retreive() from the   borrower.<br>     5. Set the invalid size parameter from the borrower side and again try to   retreive the memory region and Check for FFA_ERROR status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | MEM_LEND: Relayer usage - In an invocation of the FFA_MEM_RETRIEVE_REQ ABI, If the Receiver specifies the address ranges that must be used to map the   memory region in its translation regime, the Relayer must ensure that the   size of the memory region is equal to that specified by the Sender.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 5.12.3                            | NO                 | Follow test approach mentioned for FFA_MEM_SHARE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | MEM_SHARE: Relayer usage - In an invocation of the FFA_MEM_RETRIEVE_REQ ABI, If the memory region has been lent or shared with multiple Borrowers, the   Relayer must ensure that the identity of each Borrower specified by the   Receiver is the same as that specified by the Sender                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 5.12.3.3                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Share the  memory using ffa_mem_share()   from endpoint A to multiple endpoints except endpoint B.<br>     3. Try to retreive the memory region using ffa_mem_retreive() from endpoint   B. Check for FFA_ERROR status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  | MEM_LEND: Relayer usage -In an invocation of the FFA_MEM_RETRIEVE_REQ ABI, If the memory region has been lent or shared with multiple Borrowers, the   Relayer must ensure that the identity of each Borrower specified by the   Receiver is the same as that specified by the Sender                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 5.12.3.3                          | NO                 | Follow test approach mentioned for FFA_MEM_SHARE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | FFA_MEM_DONATE: Zero memory flag:bit[0]<br>- b0: Relayer must not zero the memory region contents<br>- b1: Relayer must zero the memory region contents                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Donate the  memory using   ffa_mem_donate() from endpoint A to endpoint B.<br>     5. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     6. Retreive the memory region using ffa_mem_retreive() from the   borrower.<br>     7. Compare the data from the retreived memory region and return fail if   data is not matched.<br>     8. Repeat the same experiment by setting zero memory flag=1.<br>     9. Check the retreived memory region content and it must be zero otherwise   return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | FFA_MEM_DONATE: Zero memory flag:bit[0] - MBZ if the Owner has Read-only access to the memory region , else the   Relayer must return DENIED                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 5.12.4.1                          | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Set the zero memory flag=1.<br>     3. Set the memory access permission bits[1:0]=0x1 in the memory access   permissions descriptor.<br>     4. Fill the total length, fragment length, address=0 and page count=0   parameters and donate the  memory using   ffa_mem_donate() from endpoint A to endpoint B.<br>     5. Check for DENIED status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                  | FFA_MEM_LEND: Zero memory flag:bit[0]<br><br>- b0: Relayer must not zero the memory region contents<br>- b1: Relayer must zero the memory region contents                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 5.12.4.1                          | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | FFA_MEM_LEND: Zero memory flag:bit[0] - MBZ if the Owner has Read-only access to the memory region , else the   Relayer must return DENIED                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 5.12.4.1                          | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | FFA_MEM_SHARE: Zero memory flag:bit[0] - MBZ in an invocation of FFA_MEM_SHARE, else the Relayer must return INVALID_PARAMETERS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Set the zero memory flag=1.<br>     3. Set the memory access permission bits[1:0]=0x1 in the memory access   permissions descriptor.<br>     4. Fill the total length, fragment length, address=0 and page count=0   parameters and share the  memory using   ffa_mem_share() from endpoint A to multiple endpoints.<br>     5. Check for INVALID_PARAMETERS status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | FFA_MEM_DONATE: Operation time slicing flag bit[1]<br>- b0: Relayer must not time slice this operation<br>- b1: Relayer can time slice this operation<br> MBZ if the Relayer does not support time slicing of memory management   operations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 5.12.4.1                          | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_MEM_LEND: Operation time slicing flag bit[1]<br><br>- b0: Relayer must not time slice this operation<br>- b1: Relayer can time slice this operation<br> MBZ if the Relayer does not support time slicing of memory management   operations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 5.12.4.1                          | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_MEM_SHARE: Operation time slicing flag bit[1]<br><br>- b0: Relayer must not time slice this operation<br>- b1: Relayer can time slice this operation<br> MBZ if the Relayer does not support time slicing of memory management   operations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 5.12.4.1                          | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Flags usage:FFA_MEM_RETRIEVE_REQ:MEM_LEND - In an invocation of FFA_MEM_RETRIEVE_REQ, during a transaction to lend or   donate memory, this flag is used by the Receiver to specify whether the   memory region must be retrieved with or without zeroing its contents first                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Lend the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     5. Set the zero memory retreive flag bit[0]= 0<br>     6. Retreive the memory region using ffa_mem_retreive() from the   borrower.<br>     7. Check the retreived memory region content and it must be zero otherwise   return fail.<br>     8. Repeat the same experiment by setting zero memory flag=0 and zero memory   retreive flag bit[0]= 1<br>     9. Compare the data from the retreived memory region and return fail if   data is not matched.<br>     10. Repeat the same experiment by setting zero memory flag=1 and zero   memory retreive flag bit[0]= 1<br>     11. Check the retreived memory region content and it must be zero otherwise   return fail.<br>     12. Repeat the same experiment by setting below parameters.<br>                 a. lend the read-only   memory to endpoint B<br>                 b. set  the zero memory retreive flag bit[0]= 0 and   check for DENIED status code.<br>     13. Repeat the same experiment by retreiving the memory again and  set    the zero memory retreive flag bit[0]= 0 and check for   INVALID_PARAMETERS status code.<br>                                                                                                                                                                                                                                                                                                         |
|                                                                  | Flags :FFA_MEM_RETRIEVE_REQ:MEM_DONATE - In an invocation of FFA_MEM_RETRIEVE_REQ, during a transaction to lend or   donate memory, this flag is used by the Receiver to specify whether the   memory region must be retrieved with or without zeroing its contents first                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 5.12.4.1                          | NO                 | Follow the above test approach and use FFA_MEM_DONATE ABI instead                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  | Flags usage:FFA_MEM_RETRIEVE_REQ:MEM_SHARE - MBZ in a transaction to share a memory region, else the Relayer must return   INVALID_PARAMETER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Fill the total length, fragment length, address=0 and page count=0   parameters and share the  memory using   ffa_mem_share() from endpoint A to endpoint B.<br>     4. Get Handle as a return parameter upon the successful completion.<br>     5. Send handle to receiver endpoint using ffa_msg_send_direct_req().<br>     6.  Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer from the borrower side.<br>     7. Set the zero memory retreive flag bit[0]= 0<br>     8.Fill the total length, fragment length, address=0 and page count=0   parameters and retreive the memory region using ffa_mem_retreive() from the   borrower.<br>     9. Check for INVALID_PARAMETERS status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Flags usage:FFA_MEM_RETRIEVE_REQ:MEM_LEND Bit[2] - Zero memory after relinquish flag<br>- In an invocation of FFA_MEM_RETRIEVE_REQ, this flag specifies whether the   Relayer must zero the memory region contents after unmapping it from the   Borrowers translation regime or if the Borrower crashes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 5.12.4.1                          | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Lend the  memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     5. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     6. Set the zero memory after relinquish flag bit[2]= 0<br>     7.Retreive the memory region using ffa_mem_retreive() from the borrower and   fill the data into the retreived memory.<br>     8. Relinquish the memory using ffa_mem_relinquish() from the   borrower.<br>     9. Reclaim the memory using ffa_mem_reclaim() from the sender.<br>     10. Check the reclaimed memory region content and if data is not matched   return fail.<br>     11. Repeat the same experiment by setting zero memory after relinquish flag   bit[2]=1 and check the reclaimed memory content and it must be zero otherwise   return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | Zero memory after relinquish flag Bit[2]<br> If the memory region is lent to multiple Borrowers, the Relayer must   clear memory region contents after unmapping it from each Borrowers   translation regime, if any Borrower including the caller sets this   flag.<br> This flag could be overridden by the Receiver in an invocation of   FFA_MEM_RELINQUISH (see Flags field in Table 150)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Lend the  memory using   ffa_mem_lend() from endpoint A to multiple endpoints.<br>     5. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     6. Set the zero memory after relinquish flag bit[2]= 1<br>     7. Retreive the memory region using ffa_mem_retreive() from the borrower   and fill the data into the retreived memory.<br>     11. Relinquish the memory using ffa_mem_relinquish() from the all the   borrowers.<br>     12. Reclaim the memory using ffa_mem_reclaim() from the sender.<br>     13. Check the reclaimed memory region content and if it is not zero return   fail.<br>     14. Repeat the same experiment by setting zero memory after relinquish flag   bit[0]=0 and check the reclaimed memory content and if data is not matched   return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
|                                                                  | Zero memory after relinquish flag Bit[2]<br>- MBZ if the Receiver has Read-only access to the memory region, else the   Relayer must return DENIED. The Receiver could be a PE endpoint or a   dependent peripheral device.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 5.12.4.1                          | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Lend the  read-only memory using   ffa_mem_lend() from endpoint A to endpoint B.<br>     5. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     6. Set the zero memory after relinquish flag bit[2]= 1<br>     7. Retreive the memory region using ffa_mem_retreive() from the   borrower.<br>     8. Relinquish the memory using ffa_mem_relinquish() from the borrower and   check for DENIED status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | Zero memory after relinquish flag Bit[2]<br> MBZ in a transaction to share a memory region, else the Relayer must   return INVALID_PARAMETER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Fill the data into the allocated memory.<br>     3. Set the zero memory flag=0.<br>     4. Share the  memory using   ffa_mem_share() from endpoint A to endpoint B.<br>     5. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     6. Set the zero memory after relinquish flag bit[2]= 1<br>     7. Retreive the memory region using ffa_mem_retreive() from the   borrower.<br>     8. Relinquish the memory using ffa_mem_relinquish() from the borrower and   check for INVALID_PARAMETER status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | Memory management transaction type flag Bit[4:3]<br> In an invocation of FFA_MEM_RETRIEVE_REQ, this flag is used by the   Receiver to either specify the memory management transaction it is   participating in or indicate that it will discover this information in the   invocation of FFA_MEM_RETRIEVE_RESP corresponding to this request.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 5.12.4.1                          | NO                 |      1. Allocate the memory region and Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer.<br>     2. Share the  memory using ffa_mem_share()   from endpoint A to endpoint B.<br>     3. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     4. Set the  memory management   transaction type flag[4:3] = 0x2(lend)<br>     5. Retreive the memory region using ffa_mem_retreive() from the borrower   and check for INVALID_PARAMETER status code.<br>     6. Repeat the same experiment for mem_lend and mem_donate and verify   invalid_parameters status code<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                  | MEM_LEND: Bit[9:5] Address range alignment hint<br> In an invocation of FFA_MEM_RETRIEVE_REQ, this flag is used by the   Receiver to specify the boundary, expressed as multiples of 4KB, to which the   address ranges allocated by the Relayer to map the memory region must be   aligned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 5.12.4.1                          | NO                 |      1. Allocate   the memory region and Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer.<br>     2. Lend the  memory using ffa_mem_lend()   from endpoint A to endpoint B.<br>     3. Fill the transaction details as described in  a memory transaction descriptor (see Table   45) in TX buffer from the borrower side.<br>     4. Set the Address range alignment hint bit[9]=0, bits[8:5]=0<br>     5.Retreive the memory region using ffa_mem_retreive() from the borrower and   check for FFA_SUCCESS code.<br>     6. Repeat the same experiment by setting below parameters.<br>                 a. Set the Address range   alignment hint bit[9]=1, bits[8:5]=1 and lend 8kb memory to borrower and   check for FFA_SUCCESS status code.<br>                 b. Set the Address range   alignment hint bit[9]=0, bits[8:5]=1 and check for INVALID_PARAMETERS status   code.<br>                 c. Set the Address range   alignment hint bit[9]=1, bits[8:5]=1 and lend 4kb memory to borrower and   check for FFA_ERROR(DENIED) status code.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                  | MEM_SHARE: Bit[9:5] Address range alignment hint<br> In an invocation of FFA_MEM_RETRIEVE_REQ, this flag is used by the   Receiver to specify the boundary, expressed as multiples of 4KB, to which the   address ranges allocated by the Relayer to map the memory region must be   aligned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 5.12.4.1                          | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | MEM_DONATE: Bit[9:5]  Address range alignment hint<br> In an invocation of FFA_MEM_RETRIEVE_REQ, this flag is used by the   Receiver to specify the boundary, expressed as multiples of 4KB, to which the   address ranges allocated by the Relayer to map the memory region must be   aligned.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | 5.12.4.1                          | NO                 | Follow test approach mentioned for FFA_MEM_LEND ABI. And use FFA_MEM_DONATE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | Common compliance requirements                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | 6.1.1                             | YES                | Following is covered as part of ffa_features_test.<br>1. Query the below abis using   ffa_features()<br>      FFA_VERSION<br>      FFA_FEATURES<br>      FFA_RX_RELEASE<br>      FFA_RXTX_MAP<br>      FFA_RXTX_UNMAP<br>      FFA_PARTITION_INFO_GET<br>      FFA_ID_GET<br>2. If any ABI is not supported return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Compliance   requirements for deploying a SP                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 6.1.2                             | YES                | Following is covered as part of ffa_features_test.<br>1.Query the   following ABIs using ffa_features() from NS-Endpoint.<br>     -FFA_RUN<br>     -FFA_MSG_SEND_DIRECT_REQ<br>     -FFA_MSG_SEND_DIRECT_RESP<br>2.Query the following ABIs using ffa_features() from   S-Endpoint.<br>     -FFA_MSG_SEND_DIRECT_REQ<br>     -FFA_MSG_SEND_DIRECT_RESP<br>3. If any ABI is not supported return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | Compliance requirements for deploying a VM                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | 6.1.3                             | YES                | Following is covered as part of ffa_features_test.<br>1. If VM supports indirect message then   query the following ABIs using ffa_features() from   NS-Endpoint.<br>     -FFA_MSG_SEND<br>     -FFA_MSG_POLL<br>     -FFA_MSG_WAIT<br>     -FFA_YIELD<br>     -FFA_RUN<br>2. If VM supports direct message then query the following ABIs using   ffa_features() from NS-Endpoint.<br>     -FFA_MSG_SEND_DIRECT_REQ<br>     -FFA_MSG_SEND_DIRECT_RESP<br>3. If any ABI is not supported return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | Compliance requirements for memory management                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | 6.1.4                             | YES                | Following is covered as part of ffa_features_test.<br>1. At least one of the following ABIs must be implemented:<br> FFA_MEM_DONATE<br> FFA_MEM_LEND<br> FFA_MEM_SHARE<br>2. The following ABIs must be implemented if any of the above ABIs are implemented:<br> FFA_MEM_RETRIEVE_REQ<br> FFA_MEM_RETRIEVE_RESP<br> FFA_MEM_RECLAIM<br> FFA_MEM_RELINQUISH<br>3. If any ABI is not supported return fail.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                                                  |  FFA_MEM_DONATE rules when using TX buffer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 11.1                              | NO                 |      1. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer.<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and call ffa_mem_donate().<br>     3. Get Handle as a return parameter upon the successful completion.<br>     4. Send handle to receiver endpoint using ffa_msg_send_direct_req().<br>     5. Retrieve the memory using ffa_mem_retrieve_req() and check for   FFA_SUCCESS status code.<br>     6. Access the memory regions from receiver endpoint.<br>     7. Pass the total length more than transaction buffer size to   ffa_mem_donate() and check for    INVALID_PARAMETERS status code.<br>     8. validate the Sender endpoint ID field in the transaction descriptor to   ensure that the Sender is the Owner of the memory region and a PE endpoint.   Must return DENIED in case of an error.<br>     9. Must ensure that a request by a SP to donate Secure memory to a NS-Endpoint   is rejected by returning the DENIED error code<br>     10. Must ensure that the memory region is in the Owner-EA state for the   Owner (see Table 35). It must return DENIED in case of error<br>     11. Verify after successful call, must ensure owner and receiver state is   <br>       Owner-NA for the Owner<br>       !Owner-NA for the Receiver.<br>     12. Parameter check- MBZ<br>                                                                                                                                                                                                                                                                                                                                     |
|                                                                  |  FFA_MEM_DONATE rules when using allocated memory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 11.1                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  |  FFA_MEM_DONATE to SEPID associated with an  dependent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 11.1                              | NO                 |      1. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) and fill the SEPID in endpoint descriptor.<br>     2. Fill the total length, fragment length, address=0 and page count=0 parameters   and donate the memory to borrower using ffa_mem_donate().<br>     3. Retrieve the memory using ffa_mem_retrieve_req() from the borrower and   check for FFA_SUCCESS status code.<br>     4. Initiate the DMA transactions to the received memory regions using   device upstream of SMMU.<br>     5. Release the RX buffer from receiver endpoint using   ffa_rx_release().<br>     6. Relinquish the memory from receiver and notify the sender.<br>     7. Reclaim the memory from the sender.<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | FFA_MEM_DONATE to SEPID associated with an independent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | 11.1                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_MEM_LEND rules when using TX buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 11.2                              | NO                 |      1. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer.<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and call ffa_mem_lend().<br>     3. Get Handle as a return parameter upon the successful completion.<br>     4. Send handle and owner endpoint id to receiver endpoint using   ffa_msg_send_direct_req().<br>     5. Retrieve the memory region using ffa_mem_retrieve_req() and check for   FFA_SUCCESS status code.<br>     6. Access the received memory regions from receiver endpoint.<br>     7. By using handle relinquish the memory from receiver endpoint using the   ffa_mem_relinquish() and check for FFA_SUCCESS status code.<br>     8. Release the RX buffer from receiver endpoint using   ffa_rx_release().<br>     9. Reclaim the memory from sender using ffa_mem_reclaim().<br>     10. Pass the total length more than transaction buffer size to   ffa_mem_lend() and check for    INVALID_PARAMETERS status code.<br>     11. validate the Sender endpoint ID field in the transaction descriptor to   ensure that the Lender is the Owner of the memory region and a PE endpoint.   Must return DENIED in case of an error.<br>     12. Ensure that a request by a SP to lend Secure memory to a NS-Endpoint is   rejected by returning the DENIED error code.<br>     13. validate that the memory region is in the Owner-EA state for the Lender   (see Table 36 ). It must return DENIED in case of an error.<br>     14. If a Borrower is a PE endpoint or a SEPID associated with a dependent   peripheral device, then:<br>      Owner-NA for the Lender<br>      !Owner-NA for the Borrower<br>       |
|                                                                  |  FFA_MEM_LEND rules when using allocated memory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 11.2                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  |  FFA_MEM_LEND to SEPID associated with an dependent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 11.2                              | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  |  FFA_MEM_LEND to SEPID associated with an independent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 11.2                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  |  FFA_MEM_SHARE rules when using TX buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 11.3                              | NO                 |      1. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer.<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and share the memory from sender using ffa_mem_share().<br>     3. Get Handle as a return parameter upon the successful completion.<br>     4. Send handle and owner endpoint id to receiver endpoint using   ffa_msg_send_direct_req().<br>     5. Retrieve the memory region using ffa_mem_retrieve_req() and check for   FFA_SUCCESS status code.<br>     6. Access the received memory regions from receiver endpoint.<br>     7. By using handle relinquish the memory from receiver endpoint using the   ffa_mem_relinquish() and check for FFA_SUCCESS status code.<br>     8. Release the RX buffer from receiver endpoint using   ffa_rx_release().<br>     9. Reclaim the memory from sender using ffa_mem_reclaim().<br>     10. Pass the total length more than transaction buffer size to   ffa_mem_share() and check for    INVALID_PARAMETERS status code.<br>     11. Must validate the Sender endpoint ID field in the transaction   descriptor to ensure that the Lender is the Owner of the memory region and a   PE endpoint. Must return DENIED in case of an error.<br>     12. Must ensure that a request by a SP to share Secure memory to a   NS-Endpoint is rejected by returning the DENIED error code.<br>     13.Must validate that the memory region is in an access state suitable for   sharing (see Table 37 ) and return DENIED in case of an error.<br>     14.If the call executes successfully, the Relayer must:<br>      Owner-SA for the Lender<br>      !Owner-NA for the Borrower.<br>      |
|                                                                  | FFA_MEM_SHARE rules when using allocated memory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | 11.3                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_MEM_SHARE to SEPID associated with an dependent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | 11.3                              | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | FFA_MEM_SHARE to SEPID associated with an independent peripheral device                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 11.3                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | FFA_MEM_RETRIEVE rules when using TX buffer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | 11.4                              | NO                 |      1. Fill the transaction details as   described in  a memory transaction   descriptor (see Table 45) in TX buffer<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and share the memory using ffa_mem_share().<br>     3. Get Handle as a return parameter upon the successful completion.<br>     4. Send handle to receiver endpoint using ffa_msg_send_direct_req().<br>     5. Fill the handle, tag, flags and other transaction details as described   in  a memory transaction descriptor   (see Table 45) in TX buffer.<br>     6. Fill the total length, fragment length, address=0 and page count=0   parameters and retrieve the memory region using ffa_mem_retrieve_req() and   check for FFA_SUCCESS status code.<br>     7. Access the memory regions from receiver endpoint.<br>     8. Pass the total length more than transaction buffer size to   ffa_mem_retrieve_req() and check for    INVALID_PARAMETERS status code.<br>     9. Pass invalid sender endpoint id to ffa_mem_retrieve_req() and check for   DENIED status code.<br>     10. Pass invalid handle and tag to ffa_mem_retrieve_req() and check for   INVALID_PARAMETERS status code.<br>     11. By using handle relinquish the memory from receiver endpoint using the   ffa_mem_relinquish() and check for FFA_SUCCESS status code.<br>     12. Release the RX buffer from receiver endpoint using   ffa_rx_release().<br>     13. Reclaim the memory from sender using ffa_mem_reclaim().<br>     14. Must return BUSY, if FFA_MEM_RETRIEVE_RESP cannot be invoked because   the Receivers RX buffer is busy.                                                                                                         |
|                                                                  | FFA_MEM_RETRIEVE rules:<br>1. The Relayer must return NO_MEMORY if there is not enough memory to map the memory region.<br>2. Must return NO_MEMORY if FFA_MEM_RETRIEVE_RESP cannot be invoked because there is not enough memory to allocate a transaction descriptor to describe   the memory region.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | 11.4                              | NO                 | Can't simulate                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|                                                                  | FFA_MEM_RETRIEVE rules when using allocated memory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | 11.4                              | NO                 | Out of scope                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Multiple retrievals by a Borrower                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | 11.4                              | NO                 |      1. Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45) in TX buffer<br>     2. Fill the total length, fragment length, address=0 and page count=0   parameters and lend the memory from sender using ffa_mem_lend().<br>     3. Fill the handle, tag, flags and other transaction details as described   in  a memory transaction descriptor   (see Table 45) in allocated memory.<br>     4. Fill the total length, fragment length, address and page count   parameters and call ffa_mem_retrieve_req() and check for FFA_SUCCESS status   code.<br>     5. Get the outstanding retreive count using ffa_features() and try to   retreive the memory region mutiple times and check for FFA_SUCCESS status   code. <br>     6. Try to retreive the memory region more than supported count and check   for DENIED status code.<br>     7. By using handle relinquish the memory from receiver endpoint using the   ffa_mem_relinquish() and check for FFA_SUCCESS status code.<br>     8. Release the RX buffer from receiver endpoint using   ffa_rx_release().<br>     9. Reclaim the memory from sender using ffa_mem_reclaim().<br>     10. Repeat these for SHARE, DONATE ABIs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | FFA_MEM_RELINQUISH ABI rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | 11.6                              | NO                 |      1.Pass invalid handle to   ffa_mem_relinquish() from the borrower and check for the      INVALID_PARAMETERS status code.<br>     2. Pass invalid flags to ffa_mem_relinquish() from the borrower and check   for the      INVALID_PARAMETERS status   code.<br>     3. Pass Endpoint count as 0 to ffa_mem_relinquish() from the borrower and   check for the  INVALID_PARAMETERS   status code.<br>     4. Set the bit[0]=1 in the Flags parameter from the borrower and check   memoy contents from the sender side. it must be zero.<br>     5.  Set the bit[0]=1 in the Flags   parameter from the borrower for read-only memory and invoke the   ffa_mem_relinquish.<br>     6. Check for DENIED status code.<br>     7.  Set the bit[0]=0 in the Flags   parameter from the borrower and check memoy contents from the sender side. If   it is zero return fail.<br>     8.Must ensure that the memory region is in the !Owner-SA or !Owner-EA state   (see Table 30) for all Borrower endpoints specified by the caller. Must   return DENIED in case of an error<br>     9. Must ensure that the memory region is unmapped from the Borrowers   translation regime (i.e. it enters the !Owner-NA state (see Table 30)) only   if it has been relinquished as many times as it has been retrieved by the   Borrower.<br>     10. MBZ parameter check.                                                                                                                                                                                                                                                                                                                                                                                        |
|                                                                  | FFA_MEM_RECLAIM ABI rules                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | 11.7                              | NO                 |      1. Pass invalid handle to ffa_mem_reclaim() from the borrower and check for the  INVALID_PARAMETERS status code.<br>     2. Pass invalid flags to ffa_mem_reclaim() from the borrower and check for the INVALID_PARAMETERS status   code.<br>     3. Set the bit[0] in the Flags parameter and check memory contents cleared or not.<br>     4. Try reclaim the memory using ffa_mem_reclaim() without mem_relinquish and check for DENIED status code.<br>     5. Must ensure that the memory region is in the !Owner-NA state (see Table 30) for all the Receiver endpoints associated with the memory region.<br>     6. If the state of the memory region for the Owner is Owner-NA i.e. the   region was lent. The Relayer must map the memory region in the translation   regime of the Owner as specified in Section 5.3.<br>     7. If the state of the memory region for the Owner is Owner-SA i.e. the   region was shared. The Relayer must map the memory region in the translation   regime of the Owner as specified in Section 5.3.<br>     8.If the call executes successfully, the state of the memory region for the   Owner must transition to Owner-EA.<br>     9. MBZ parameter check                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Each execution context must be allocated a ID that is unique amongst all execution contexts   that belong to the endpoint.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                   | NO                 | Can't simulate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Fragment transmission rules while retrieving memory                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | 12.2                              | NO                 | Out of scope<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|                                                                  | A message from one VM can be sent to another without the contents changing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                   | NO                 |      1. Allocate RX and TX memory and register   using ffa_rxtx_map() from VM0 and VM1.<br>     2. Fill valid sender(VM0), receiver ids(VM1) and message length   parameters.<br>     3. Set bit[0] = 0 in the flag parameter and call ffa_msg_send() abi from   VM0.<br>     4. Check the all expected fileds from receiver endpoint. If expected values   are not matching from receiver endpoint return fail.<br>     5. Unmap the TX and RX memory using ffa_rxtx_unmap() from VM0 and VM1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                  | Endpoint can't donate region to itself                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                   | NO                 |      1. Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45).<br>     2. Fill the same  owner and borrower   endpoint id in the memory descriptor. <br>     3. Fill the total length, fragment length, address and page count   parameters and try to donate the memory using ffa_mem_doante() and check for   INVALID_PARAMETERS status code.<br>     <br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                  | Lend memory from the sender to the receiver and ensure it is not possible to access memory surrounding the received   memory in both single constituent and multiple constituent modes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                   | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_LEND instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                  | Endpoint can't lend to itself                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |                                   | NO                 |      1. Fill the   transaction details as described in  a   memory transaction descriptor (see Table 45).<br>     2. Fill the same  owner and borrower   endpoint id in the memory descriptor. <br>     3. Fill the total length, fragment length, address and page count   parameters and try to lend the memory using ffa_mem_lend() and check for   INVALID_PARAMETERS status code.<br>     <br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|                                                                  | share memory from the sender to the receiver and ensure it is not possible to access memory surrounding the received memory in both single constituent and multiple constituent modes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |                                   | NO                 | Follow test approach mentioned for FFA_MEM_DONATE ABI. And use FFA_MEM_SHARE instead.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                  | Share memory to NS-EP, SP and SEP-ID multilple borrowers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |                                   | NO                 | Share the memory to NS-EP, SP and SEP-ID multiple borrowers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|                                                                  | Lend memory region to others and then  attempt to lend the part of the region to one of the party                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |                                   | NO                 | Lend the memory region from EP A to other endpoints. Try to lend the part of memory to another endpoint and check   for error status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                                                  | Donate memory region to other endpoint and then attempt to transfer ownership of a part of the region to one of the party.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |                                   | NO                 | Donate the memory region from EP A to other endpoint. Try to transfer ownership the part   of memory to another endpoint and check for error status code.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                  | Send indirect message to another NS-EP, corrupt the TX buffer from the sender before scheduling the receiver                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                   | NO                 | 1. Send indirect message from endpoint A to B. Corrupt the sender TX buffer before scheduling the receiver.<br>2. Schedule the Receiver and validate the sender message.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

## Notes
1. Unless described in this document, any behaviour that is defined as IMPLEMENTATION_DEFINED in Arm FF-A specification document is not verified by the ACS.
2. ACS supports only Aarch64 endpoints configuration. Aarch32 endpoints and endpoint under VHE configuration are not part of the release.
3. Following architecture features of Arm FF-A specification are not part of the release:
-	Optional memory management features
-	Dynamic buffers for descriptor
-	Fragmented descriptor
-	Time slicing of memory manage operation
-	Memory management operation involving independent peripheral Device

## License

Arm FF-A ACS is distributed under BSD-3-Clause License.

--------------

*Copyright (c) 2021, Arm Limited or its affliates. All rights reserved.*
